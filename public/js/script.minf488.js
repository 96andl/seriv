(function(c,k,q){c.fn.vlsGfAlbum=function(q){function u(v){function r(){"metro"==y&&q(!0)}function q(h){if(640>=c(k).width())return a.find(".vls-gf-thumbnail-container").css("height",""),!0;for(var b=a.data("vlsGfAspectRatio"),d=a.data("vlsGfHorizontalSpacing"),w=a.data("vlsGfVerticalSpacing"),e=a.data("vlsGfColumnCount"),g=Math.floor(a[0].getBoundingClientRect().width),l=[],m=0,t=-1,r=0,f=g-d*(e-1),n=Math.floor(f/e),f=f-n*e,p=0;p<e;p++)l[p]=n,0<f&&(l[p]++,f--);m=Math.round(n/b);a.find('.vls-gf-page:not(".vls-gf-hidden") .vls-gf-item').each(function(){var b=
c(this),h=b.data("vlsGfImageAspect"),a=b.data("vlsGfWidth"),e=b.data("vlsGfHeight"),g=b.data("vlsGfCol"),f=b.data("vlsGfRow"),k=0,n=0,q=0,z=0;0>t&&(t=f);f-=t;for(p=g;p<g+a;p++)k+=l[p];k+=d*(a-1);n=m*e+w*(e-1);for(p=0;p<g;p++)q+=l[p];q+=d*g;z=m*f+w*f;b.css({width:k,height:n,left:q,top:z});k/n>h?b.find("img").removeClass("vls-gf-wide").addClass("vls-gf-tall"):b.find("img").removeClass("vls-gf-tall").addClass("vls-gf-wide");r<f+e-1&&(r=f+e-1)});b=m*(r+1)+w*r;a.find(".vls-gf-thumbnail-container").css("height",
b+"px");h&&g!=parseInt(a.width())&&q(!1)}function n(){if("numbers"==e||"bullets"==e){var h=[],b=[],d;if(7>=l||"bullets"==e)for(d=1;d<=l;d++)b.push(d);else if(3>=g){for(d=1;5>=d;d++)b.push(d);b.push(0);b.push(l)}else if(g>l-3)for(b.push(1),b.push(0),d=l-4;d<=l;d++)b.push(d);else{b.push(1);b.push(0);for(d=g-1;d<=g+1;d++)b.push(d);b.push(0);b.push(l)}"numbers"==e&&(a=c("<a/>",{text:"<<"}),1<g?(a.attr("href","#page/"+(g-1)),a.on("click.vls-gf",function(){var b=parseInt(c(this).attr("href").replace("#page/",
""));x(b);return!1})):a.addClass("vls-gf-disabled"),h.push(a));for(d=0;d<b.length;d++){var a,f=b[d];0==f?a=c("<span />",{text:"..."}):(a=c("<a/>",{href:"#page/"+f,text:"numbers"==e?f:""}),f==g&&a.addClass("vls-gf-active"),a.on("click.vls-gf",function(b){var a=parseInt(c(this).attr("href").replace("#page/",""));x(a);b.preventDefault();return!1}));h.push(a)}"numbers"==e&&(a=c("<a/>",{text:">>"}),g<l?(a.attr("href","#page/"+(g+1)),a.on("click.vls-gf",function(){var b=parseInt(c(this).attr("href").replace("#page/",
""));x(b);return!1})):a.addClass("vls-gf-disabled"),h.push(a));m.empty().append(h)}}function x(h){g=h;n();var b=a.find('.vls-gf-page[data-vls-gf-page-no="'+h+'"]');0<b.length?A(b):c.get(vls_gf_script_l10n.ajaxurl,{action:"vls_gf_get_album_page",album_id:t,page_no:h},function(b){a.find(".vls-gf-thumbnail-container").append(b);b=a.find(".vls-gf-page:last");A(b);c().vlsGfLazyload&&b.find("img[data-original]").vlsGfLazyload({threshold:100,effect:"fadeIn"})},"html")}function A(h){h.removeClass("vls-gf-hidden");
var b=h.data("vlsGfPageNo");a.find(".vls-gf-page").each(function(){var a=c(this);a.data("vlsGfPageNo")!=b&&a.addClass("vls-gf-hidden")});r();u(h);var d=h.closest(".vls-gf-album").data("vlsGfLightbox");d&&"function"===typeof d.updateTargets&&d.updateTargets(h,!1)}function B(){if(f)return!1;f=!0;m.addClass("vls-gf-busy");g++;var h=a.find('.vls-gf-page[data-vls-gf-page-no="'+g+'"]');0<h.length?(C(h),f=!1,m.removeClass("vls-gf-busy"),g>=l&&(c(k).off("scroll.vls-gf-"+t),m.remove())):c.get(vls_gf_script_l10n.ajaxurl,
{action:"vls_gf_get_album_page",album_id:t,page_no:g},function(b){a.find(".vls-gf-thumbnail-container").append(b);b=a.find(".vls-gf-page:last");C(b);c().vlsGfLazyload&&b.find("img[data-original]").vlsGfLazyload({threshold:100,effect:"fadeIn"});f=!1;m.removeClass("vls-gf-busy");g>=l&&(c(k).off("scroll.vls-gf-"+t),m.remove())},"html");return!1}function D(){if(!f){var a=c(k),a=a.scrollTop()+a.height(),b=m.offset().top;a>b&&B()}}function C(a){a.removeClass("vls-gf-hidden");r();var b=a.closest(".vls-gf-album").data("vlsGfLightbox");
b&&"function"===typeof b.updateTargets&&b.updateTargets(a,!0);c(k).trigger("scroll.vls-gf-lazyload")}function u(a){var b=Math.floor(c(k).scrollTop());a=a.closest(".vls-gf-thumbnail-container").offset().top;b>a&&(b=80,640>=c(k).width()&&(b=4),c("html,body").scrollTop(a-b))}var a=c(v),t=a.data("vlsGfAlbumId"),y="",e="none",g=1,l=a.data("vlsGfTotalPages"),m,f=!1;a.removeClass("no-js");a.hasClass("vls-gf-album-metro")&&(y="metro",c(k).on("resize.vls-gf-"+t,r));a.hasClass("vls-gf-paginated-paged-numbers")?
e="numbers":a.hasClass("vls-gf-paginated-paged-bullets")?e="bullets":a.hasClass("vls-gf-paginated-load-more")?e="load-more":a.hasClass("vls-gf-paginated-load-scroll")&&(e="load-scroll");"none"!=e&&(m=c("<div />").addClass("vls-gf-pagination-control").appendTo(a));1<l&&("numbers"==e||"bullets"==e?n():"load-more"==e?"load-more"==e&&(v=c("<button />").text("Load more").appendTo(m),v.on("click.vls-gf",B),c("<span/>").appendTo(m)):"load-scroll"==e&&"load-scroll"==e&&(c("<span/>").appendTo(m),c(k).on("scroll.vls-gf-"+
t,D),D()));r();return{updateLayout:r}}var n=this;(function(){c(k).on("resize.vls-gf",function(){n.each(function(){c(this).data("vlsGfAlbum").updateLayout()})});c().vlsGfLazyload&&c(".vls-gf-album img[data-original]").vlsGfLazyload({threshold:100,effect:"fadeIn"});n.each(function(){c.data(this,"vlsGfAlbum",new u(this))})})();return this};c(q).ready(function(){c(".vls-gf-album").vlsGfAlbum()})})(jQuery,window,document);
